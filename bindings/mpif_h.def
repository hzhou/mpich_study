macros:
    src: $ENV{HOME}/work/mpich-github/src
    mpi_h: $(src)/include/mpi.h.in
    mpio_h: $(src)/mpi/romio/include/mpio.h.in

# chdir mpif_h
# perl buildiface > /dev/null
#     -infile=cf90t.h     # $prototype_file
#     -deffile=cf90tdefs  # require $definition_file

page: buildiface
    my $prototype_file = "$(mpi_h)"
    my $definition_file
    my $build_prototypes = 1

    $if $definition_file
        require $definition_file

    $global %skipBlocks = ()
    ReadAndProcessInterface($prototype_file, 0)

    $if -s "$(src)/mpi/romio/include/mpio.h.in"
        %skipBlocks = (
            HAVE_MPI_DARRAY_SUBARRAY => 1,
            HAVE_MPI_INFO => 1,
            MPICH => 1,
            );
        ReadAndProcessInterface("$(mpio_h)", 1)

    $if is_MPI
        build_specials()
    $else
        $for $i=0:@ExtraRoutines
            &{$ExtraRoutines[$i]}()

    $if $build_prototypes
        &call open_W, $prototype_header_file.new
            $call @prototype_copyright

    $if $buildMakefile
        $call dump_Makefile_mk

#---------------------------------------- 
fncode: ReadAndProcessInterface($f, $protect_MPIO)


#---------------------------------------- 
subcode: dump_Makefile_mk
    &call open_W, Makefile.mk.new
        # preamble
        $print EXTRA_DIST += src/binding/fortran/mpif_h/buildiface
        $print if MAINTAINER_MODE
        # ...
        $print if BUILD_F77_BUILD
        $print     mpi_f77_sources +=
        $foreach $f in @files
            $print "src/binding/fortran/mpif_h/$f "
        $print     mpi_core_sources +=
        $print     mpi_sources +=
        $print AM_CPPFLAGS +=
        $print noinst_HEADERS +=
        $print DISTCLEANFILES +=
        $print nodist_include_HEADERS +=

subcode: prototype_copyright
    $print /* -*- Mode: C; c-basic-offset:4 ; -*- */
    $print /*
    $print  * (C) 2001 by Argonne National Laboratory.
    $print  *     See COPYRIGHT in top-level directory.
    $print  *
    $print  * This file is automatically generated by buildiface
    $print  * DO NOT EDIT
    $print  */
    $print /* Prototypes for Fortran Interface Functions */
