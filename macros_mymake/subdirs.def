subcode: make_hwloc
    my @t
    push @t, "cd $moddir/hwloc"
    push @t, "sh autogen.sh"
    push @t, "./configure --enable-embedded-mode --enable-visibility"
    push @t, "\x24(MAKE)"

    push @extra_make_rules, "$(Lhwloc):"
    push @extra_make_rules, "\t(". join(' && ', @t). ")"
    push @extra_make_rules, ""

#---------------------------------------- 
subcode: prepare_mpl
    $if !-f "src/mpl/include/mplconfig.h"
        &call compile_subdir, src/mpl
            system "rsync -r ../../confdb/ confdb/" 
            system "autoreconf -ivf"
            system "./configure --disable-versioning --enable-embedded"

subcode: compile_mpl
    my @t
    push @t, "cd src/mpl"
    $(if:0)
        # need run first because of "mplconfig.h"
        push @t, "rsync -r ../../confdb/ confdb/"
        push @t, "autoreconf -ivf"
        push @t, "./configure --disable-versioning --enable-embedded"
    $(else)
        $call prepare_mpl
    push @t, "\x24(MAKE)"

    push @extra_make_rules, "$(Lmpl):"
    push @extra_make_rules, "\t(". join(' && ', @t). ")"
    push @extra_make_rules, ""

#---------------------------------------- 
subcode: prepare_opa
    $if !-f "src/openpa/src/opa_config.h"
        &call compile_subdir, src/openpa
            system "autoreconf -ivf"
            system "./configure --disable-versioning --enable-embedded"

subcode: compile_opa
    my @t
    push @t, "cd src/openpa"
    $(if:0)
        # need run first because of "opa_config.h"
        push @t, "autoreconf -ivf"
        push @t, "./configure --disable-versioning --enable-embedded"
    $(else)
        $call prepare_opa
    push @t, "\x24(MAKE)"

    push @extra_make_rules, "$(Lopa):"
    push @extra_make_rules, "\t(". join(' && ', @t). ")"
    push @extra_make_rules, ""

#---------------------------------------- 
subcode: compile_subdir(dir)
    my $pwd = `pwd`
    chomp $pwd
    $print =========== $(dir) ============
    chdir "$(dir)" or die "can't chdir $(dir)\n"
    BLOCK
    chdir $pwd

