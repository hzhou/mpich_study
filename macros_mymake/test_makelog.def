subcode: report_make_log
    my @make_log
    $if $compiler=~/intel|icc/
        $call parse_make_log_icc
    $elif $compiler=~/pgi/
        $call parse_make_log_pgi
    $elif $compiler=~/sun/
        $call parse_make_log_sun
    $else
        $call parse_make_log
    my $n_fails = @make_log
    $(set:LIMIT=10000)
    $if $n_fails>=$(LIMIT)
        $n_fails = $(LIMIT)
    my $n_tests = $n_fails+1
    &call open_W, summary.junit.xml
        $print <testsuites>
        $print <testsuite failures="$n_fails" errors="0" skipped="0" tests="$n_tests" name="warning">
        my $dur = $time_finish-$time_start
        $print <testcase name="1 - build" time="$dur"></testcase>
        my $i = 1
        $foreach $t in @make_log
            $if $i>$(LIMIT)
                last
            $i++
            $t=~s/"//g
            $t=~s/</&lt;/g
            $t=~s/>/&gt;/g
            my $o = parse_warning($t)
            $if $o
                $print <testcase name="$o->{file}:$o->{line}">
            $else
                $print <testcase name="$i">
            $if $o->{skip}
                $print <skipped type="TodoTestSkipped" message="$o->{skip}">
                $print <![CDATA[$t]]>
                $print </skipped>
            $else
                $print <failure message="$t">
                $print Build details are in make.log.
                # $print <![CDATA[$t]]>
                $print </failure>
            $print </testcase>
        $print </testsuite>
        $print </testsuites>

    subcode: parse_make_log
        my $f="make.log"
        $if $ENV{outoftree} eq "true"
            $f="build/make.log"
        &call open_r, $f
            # ./src/mpid/ch4/src/ch4r_proc.h:170:93: warning: declaration of ‘index’ shadows a global declaration [-Wshadow]
            $if /^(\S+:\d+:\s*(error|warning):\s*.*)/ -> $t
                push @make_log, $t

    subcode: parse_make_log_icc
        &call open_r, make.log
            # ./src/mpid/ch3/include/mpid_coll.h(26): warning #177: label "fn_exit" was declared but never referenced
            $if /^(\S+\(\d+\): (error|warning) #\d+:\s*.*)/ -> $t
                push @make_log, $t

    subcode: parse_make_log_pgi
        &call open_r, make.log
            # PGC-W-0114-More than one type specified (/var/lib/jenkins-slave/workspace/hzhou-warnings-more/compiler/pgi/config/ch3-tcp/label/centos64/modules/mpl/include/uthash.h: 90)
            $if /^(PGC-W-\d+-.*)/ -> $t
                push @make_log, $t

    subcode: parse_make_log_sun
        my %got_hash
        &call open_r, make.log
            # "src/include/mpir_handlemem.h", line 120: warning: null dimension: indirect
            $if /^(".*",\s*line \d+:\s*warning:.*)/ -> $t
                $if $t=~/opa_gcc_intel_32_64_ops/
                    $if !$got_hash{opa_asm}
                        push @make_log, $t
                        $got_hash{opa_asm}=1
                $else
                    push @make_log, $t


fncode: parse_warning($t)
    my $o
    $if $t=~/^(\S+):(\d+):/ # gcc
        $o = { file=>$1, line=>$2 }
    $elif $t=~/^(\S+)\((\d+)\):/ # icc
        $o = { file=>$1, line=>$2 }
    $elif $t=~/^PGC-.*\((.*):\s*(\d+)\)/ # pgi
        $o = { file=>$1, line=>$2 }
    $elif $t=~/"(.*)", line (\d+): warning:/ # suncc
        $o = { file=>$1, line=>$2 }
    $elif $t=~/(\S+), line (\d+): warning:/ # suncc
        $o = { file=>$1, line=>$2 }

    $if $o
        $if $o->{file}=~/^\/var\/.*\/mymake\/(.*)/g
            $o->{file}="~$1"
            $if $o->{file}=~/^~(ucx|libfabric)/
                $o->{skip}="external module: $1"
        $if $t=~/warning #177:/
            # icc: label "xxx" was declared but never referenced
            $o->{skip}="icc: warning #177: unused label"
        $elif $compiler eq "gcc-4" and $t=~/\[(-Wmaybe-uninitialized)\]/
            $o->{skip}="gcc-4: $1"
        return $o
    $else
        return undef
