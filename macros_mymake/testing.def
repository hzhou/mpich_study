subcode: prepare_testing
    my $dir = "test/mpi"
    my $srcdir="../.."
    chdir $dir or die "Can't chdir $dir\n"
    $if !-d "mymake"
        mkdir "mymake" or die "Can't mkdir mymake\n"

    $call @testing_config
    system "cp Makefile mymake/Makefile.orig"

subcode: run_tests
    system "make testing"

# --------------------------------
macros:
    # FIXME: test features
    disable_tests: --disable-romio --disable-ft-tests --disable-perftest

subcode: testing_config
    system "rsync -r $srcdir/confdb/ confdb/"
    system "cp $srcdir/maint/version.m4 ."
    system "sh autogen.sh"
    system "autoreconf -ivf"
    my $t = join(' ', @test_config_options)
    system "./configure $t"

    system "cp Makefile mymake/Makefile.orig"

